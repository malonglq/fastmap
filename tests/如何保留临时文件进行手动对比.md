# 如何保留临时文件进行手动对比

## 🎯 目的
在运行XML写入测试时，保留临时文件，以便您可以手动对比原始文件和修改后的文件，亲自确认值替换是否正确。

## 🔧 使用方法

### Windows PowerShell
```powershell
# 设置环境变量保留临时文件
$env:KEEP_TEMP_FILES = "1"

# 运行测试并查看详细日志
python -m pytest tests/unit/TC-MAP-004_XML写入功能测试.py::TestTC_MAP_004_XML写入功能测试::test_real_data_value_replacement_verification -v -s --log-cli-level=INFO

# 测试完成后清除环境变量（可选）
Remove-Item Env:KEEP_TEMP_FILES
```

### Windows CMD
```cmd
# 设置环境变量保留临时文件
set KEEP_TEMP_FILES=1

# 运行测试并查看详细日志
python -m pytest tests/unit/TC-MAP-004_XML写入功能测试.py::TestTC_MAP_004_XML写入功能测试::test_real_data_value_replacement_verification -v -s --log-cli-level=INFO

# 测试完成后清除环境变量（可选）
set KEEP_TEMP_FILES=
```

### 一行命令（推荐）
```powershell
# PowerShell一行命令
$env:KEEP_TEMP_FILES = "1"; python -m pytest tests/unit/TC-MAP-004_XML写入功能测试.py::TestTC_MAP_004_XML写入功能测试::test_real_data_value_replacement_verification -v -s --log-cli-level=INFO; Remove-Item Env:KEEP_TEMP_FILES
```

## 📋 预期输出

当设置了 `KEEP_TEMP_FILES=1` 时，测试会显示类似以下的输出：

```
==liuq debug== 🔍 临时文件保留模式
==liuq debug== 📁 原始文件: E:\code\3__My\22_tool_fastmapv2\0_fastmapv2_latest\tests\test_data\awb_scenario.xml
==liuq debug== 📁 临时文件: C:\Users\w9065706\AppData\Local\Temp\tmp12345678\test_awb_scenario.xml
==liuq debug== 📁 临时目录: C:\Users\w9065706\AppData\Local\Temp\tmp12345678
==liuq debug== 💡 测试完成后，您可以手动对比这两个文件

... 测试执行过程 ...

==liuq debug== 🎯 临时文件已保留，请手动对比:
==liuq debug== 📄 原始文件: E:\code\3__My\22_tool_fastmapv2\0_fastmapv2_latest\tests\test_data\awb_scenario.xml
==liuq debug== 📄 修改后文件: C:\Users\w9065706\AppData\Local\Temp\tmp12345678\test_awb_scenario.xml
==liuq debug== 🗂️  临时目录: C:\Users\w9065706\AppData\Local\Temp\tmp12345678
==liuq debug== ⚠️  请手动删除临时目录: C:\Users\w9065706\AppData\Local\Temp\tmp12345678
```

## 🔍 手动对比方法

### 方法1：使用文本编辑器对比
1. 用您喜欢的文本编辑器（如VSCode、Notepad++）打开两个文件
2. 使用编辑器的对比功能查看差异

### 方法2：使用Windows文件对比工具
```powershell
# 使用Windows内置的FC命令对比文件
fc "原始文件路径" "修改后文件路径"
```

### 方法3：使用专业对比工具
- **Beyond Compare**
- **WinMerge**（免费）
- **VSCode Diff功能**

## 📊 预期的修改内容

测试会修改前2个Map点的offset值：
- **Map点0**: offset_x改为99.999, offset_y改为88.888
- **Map点1**: offset_x改为100.999, offset_y改为89.888

您应该能在修改后的文件中找到这些具体的数值变化。

## 🧹 清理临时文件

测试完成后，请手动删除临时目录：
```powershell
# 删除临时目录（替换为实际的临时目录路径）
Remove-Item -Recurse -Force "C:\Users\w9065706\AppData\Local\Temp\tmp12345678"
```

## 🎯 验证要点

在手动对比时，请重点关注：

1. **值是否正确替换**：检查offset_x和offset_y的值是否变为预期值
2. **文件格式是否保持**：确认XML格式没有被破坏
3. **只替换值不格式化**：确认只有数值发生变化，其他格式保持不变
4. **备份文件是否创建**：检查是否在临时目录的backups子目录中创建了备份文件

## 🚀 其他测试文件

这个功能也适用于其他测试文件：

```powershell
# XML加载测试
$env:KEEP_TEMP_FILES = "1"; python -m pytest tests/unit/TC-MAP-001_XML文件加载测试.py -v -s --log-cli-level=INFO

# EXIF解析测试
$env:KEEP_TEMP_FILES = "1"; python -m pytest tests/unit/TC-EXIF-001_EXIF解析测试.py -v -s --log-cli-level=INFO

# CSV分析报告测试
$env:KEEP_TEMP_FILES = "1"; python -m pytest tests/unit/TC-REPORT-001_分析报告页面加载CSV文件测试.py -v -s --log-cli-level=INFO
```

## 💡 提示

- 临时文件通常在 `C:\Users\用户名\AppData\Local\Temp\` 目录下
- 每次运行测试都会创建新的临时目录
- 建议测试完成后及时清理临时文件以节省磁盘空间
