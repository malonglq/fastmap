<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EXIF对比分析报告 - Chart.js修复版</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
console.log('==liuq debug== 开始加载Chart.js');
(function(){
  var cdnUrls = [
    'assets/chart.umd.min.js',
    'https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js',
    'https://unpkg.com/chart.js@4.4.1/dist/chart.umd.min.js',
    'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js'
  ];
  var currentIndex = 0;
  
  function loadChart() {
    if (currentIndex >= cdnUrls.length) {
      console.error('==liuq debug== 所有Chart.js CDN都加载失败');
      return;
    }
    
    var url = cdnUrls[currentIndex];
    console.log('==liuq debug== 尝试加载Chart.js:', url);
    
    var script = document.createElement('script');
    script.src = url;
    script.onload = function() {
      console.log('==liuq debug== Chart.js加载成功:', url);
      console.log('==liuq debug== Chart对象检查:', typeof Chart !== 'undefined' ? 'OK' : 'FAILED');
    };
    script.onerror = function() {
      console.warn('==liuq debug== Chart.js加载失败:', url);
      currentIndex++;
      setTimeout(loadChart, 100);
    };
    
    document.head.appendChild(script);
  }
  
  loadChart();
})();
</script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; text-align: center; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        h2 { color: #007bff; margin-top: 30px; }
        .summary { background: #e9f4ff; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .chart-container { margin: 20px 0; height: 360px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #343a40; color: white; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .highlight-high { background-color: #ffebee !important; }
        .highlight-medium { background-color: #fff3e0 !important; }
        .change-positive { color: #28a745; font-weight: bold; }
        .change-negative { color: #dc3545; font-weight: bold; }
        .change-neutral { color: #6c757d; }
        .table-container { max-height: 500px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 5px; }
        .field-section { margin: 30px 0; border: 1px solid #ddd; border-radius: 5px; padding: 15px; }
        .kpi-cards { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        .kpi-card { background:#fafafa; border:1px solid #eee; border-radius:6px; padding:12px; text-align:center; }
        .kpi-title { color:#666; font-size:12px; }
        .kpi-value { font-size:20px; font-weight:bold; margin-top:6px; }
        .muted { color:#888; font-size:12px; }
        .pill { display:inline-block; padding:2px 6px; border-radius:10px; background:#eef5ff; color:#3572b0; font-size:12px; margin-left:6px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>EXIF对比分析报告 - Chart.js修复版</h1>

        <div class="summary">
            <h3>报告摘要</h3>
            <p><strong>测试机文件:</strong> 测试数据</p>
            <p><strong>对比机文件:</strong> 参考数据</p>
            <p><strong>匹配场景数:</strong> 3 <span class="pill">覆盖率 100.0%</span></p>
            <p><strong>分析字段数:</strong> 2</p>
            <p><strong>生成时间:</strong> 2025-08-08 Chart.js修复版</p>
        </div>

        <!-- 测试图表区域 -->
        <div class="field-section">
          <h3>color_sensor_irRatio 分析</h3>
          <div class="row">
            <div class="col-md-8">
              <div class="chart-container" style="height:320px;">
                <canvas id="chart_test_field" style="width:100%;height:100%;display:block;"></canvas>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-2"><strong>变化分布</strong></div>
              <div class="chart-container" style="height:320px;">
                <canvas id="dist_test_field" style="width:100%;height:100%;display:block;"></canvas>
              </div>
            </div>
          </div>
        </div>

    </div>

    <script>
        // 测试图表渲染脚本
        (function() {
          function renderChart() {
            if (typeof Chart === 'undefined') {
              console.warn('==liuq debug== Chart.js 未加载，等待中... test_field');
              setTimeout(renderChart, 200);
              return;
            }
            
            console.log('==liuq debug== 开始渲染图表: test_field');

            // 折线图
            var ctx = document.getElementById('chart_test_field');
            if (ctx) {
              var c = ctx.getContext('2d');
              new Chart(c, {
                type: 'line',
                data: {
                  labels: ["1", "2", "3"],
                  datasets: [
                    {
                      label: '测试机',
                      data: [0.85, 0.87, 0.82],
                      borderColor: '#e91e63',
                      backgroundColor: 'rgba(233,30,99,0.15)',
                      tension: 0.2,
                      pointRadius: 2
                    },
                    {
                      label: '对比机',
                      data: [0.83, 0.89, 0.80],
                      borderColor: '#3f51b5',
                      backgroundColor: 'rgba(63,81,181,0.15)',
                      tension: 0.2,
                      pointRadius: 2
                    }
                  ]
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  plugins: {
                    title: {
                      display: true,
                      text: 'color_sensor_irRatio 趋势对比'
                    },
                    legend: {
                      display: true,
                      position: 'top'
                    }
                  },
                  scales: {
                    y: {
                      beginAtZero: false
                    }
                  }
                }
              });
              console.log('==liuq debug== 折线图渲染完成: test_field');
            }

            // 环形图
            var dctx = document.getElementById('dist_test_field');
            if (dctx) {
              var dc = dctx.getContext('2d');
              new Chart(dc, {
                type: 'doughnut',
                data: {
                  labels: [">10%", "1~10%", "0%", "-1~-10%", "<-10%"],
                  datasets: [{
                    data: [0, 1, 1, 1, 0],
                    backgroundColor: ['#2ecc71', '#95a5a6', '#3498db', '#f39c12', '#e74c3c']
                  }]
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  plugins: {
                    legend: {
                      display: true,
                      position: 'right'
                    },
                    title: {
                      display: true,
                      text: '变化分布'
                    }
                  }
                }
              });
              console.log('==liuq debug== 环形图渲染完成: test_field');
            }
          }
          
          // 启动图表渲染
          renderChart();
        })();
    </script>
</body>
</html>
        
