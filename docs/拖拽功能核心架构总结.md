🎯 拖拽功能核心架构总结
📋 主要依赖文件和关键函数
1. utils/pywin_drop.py - 主要COM拖拽实现
关键函数：

install_pywin_drop(hwnd, on_files) - 注册COM拖拽接口
_DropTarget.Drop() - 处理拖拽事件，解析文件
_DropTarget._extract_cf_hdrop() - 解析标准文件拖拽
_DropTarget._extract_virtual_files() - 处理虚拟文件拖拽
2. utils/win_drop.py - WM_DROPFILES备用机制
关键函数：

install_win_drop(hwnd, on_files) - 注册Windows原生拖拽
_WinDropFilter.nativeEventFilter() - 处理WM_DROPFILES消息
3. gui/main_window.py - Qt拖拽系统和事件处理
关键函数：

showEvent() - 窗口显示时注册pywin_drop
dragEnterEvent() - Qt拖拽进入事件
dropEvent() - Qt拖拽释放事件
eventFilter() - 全局事件过滤器
_on_native_files() - 统一文件处理回调
setup_drag_and_drop() - 初始化拖拽系统
_install_all_drop_handlers() - 递归安装拖拽处理器
🧹 删减状态确认
✅ 已删除的无效组件
utils/ole_drop.py - 完全删除，确认无效
相关方法：
_install_ole_drop() - 已删除
_show_ole_fallback_window() - 已删除
closeEvent中的ole清理代码 - 已删除
✅ 保留的工作组件
utils/pywin_drop.py - 主要拖拽实现，已修复
utils/win_drop.py - 备用机制，正常工作
Qt拖拽系统 - 事件处理，100+组件启用
🎯 工作流程
初始化阶段：setup_drag_and_drop() → _install_all_drop_handlers()
窗口显示：showEvent() → install_pywin_drop()
拖拽事件：COM接口 → _DropTarget.Drop() → _on_native_files()
备用机制：WM_DROPFILES → nativeEventFilter() → _on_native_files()
Qt处理：dragEnterEvent() / dropEvent() → _on_native_files()