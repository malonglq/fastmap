# 拖拽功能代码清理 - 测试用例详细规范
**创建时间:** 2025-01-13 14:45:00 +08:00  
**责任人:** LD  
**关联任务:** 拖拽功能代码清理任务.md

## 测试环境准备

### 测试数据准备
```
测试图片文件:
- test_image_small.jpg (< 1MB, 标准EXIF数据)
- test_image_large.jpeg (> 10MB, 完整EXIF数据)  
- test_image_minimal.jpg (最小EXIF数据)
- test_image_corrupted.jpg (损坏的图片文件)
- test_file.txt (非图片文件)
- test_image_network.jpg (网络路径文件)
```

### 性能基准数据
```
启动时间基线: 记录当前应用启动到主窗口显示的时间
拖拽响应基线: 记录从拖拽开始到EXIF弹窗显示的时间
内存使用基线: 记录应用启动后的内存占用
CPU使用基线: 记录拖拽操作时的CPU峰值
```

## TC001 - 基础拖拽功能测试

### TC001-01: 拖拽单个JPG文件
**前置条件:** 应用已启动，主窗口可见
**测试步骤:**
1. 从文件管理器选择test_image_small.jpg
2. 拖拽到主窗口任意区域
3. 释放鼠标
**预期结果:** 
- EXIF快速查看对话框正常弹出
- 对话框标题显示文件名
- EXIF数据按优先级正确显示
- 关闭按钮功能正常
**验收标准:** 对话框在500ms内弹出，数据显示完整

### TC001-02: 拖拽单个JPEG文件
**前置条件:** 应用已启动，主窗口可见
**测试步骤:**
1. 从文件管理器选择test_image_large.jpeg
2. 拖拽到主窗口任意区域
3. 释放鼠标
**预期结果:** 
- EXIF快速查看对话框正常弹出
- 大文件处理无明显延迟
- 数据显示完整无截断
**验收标准:** 对话框在1000ms内弹出，内存使用无异常增长

### TC001-03: 拖拽非图片文件
**前置条件:** 应用已启动，主窗口可见
**测试步骤:**
1. 从文件管理器选择test_file.txt
2. 拖拽到主窗口任意区域
3. 释放鼠标
**预期结果:** 
- 显示警告对话框："仅支持 .jpg/.jpeg 文件"
- 不弹出EXIF查看对话框
- 应用状态无异常
**验收标准:** 警告提示准确，无异常日志

### TC001-04: 拖拽多个文件
**前置条件:** 应用已启动，主窗口可见
**测试步骤:**
1. 从文件管理器选择多个图片文件
2. 拖拽到主窗口任意区域
3. 释放鼠标
**预期结果:** 
- 仅处理第一个文件
- 弹出第一个文件的EXIF对话框
- 其他文件被忽略
**验收标准:** 只显示一个EXIF对话框，处理逻辑正确

## TC002 - EXIF数据完整性测试

### TC002-01: EXIF字段优先级验证
**前置条件:** 使用包含完整EXIF数据的测试图片
**测试步骤:**
1. 拖拽test_image_large.jpeg到主窗口
2. 检查EXIF对话框中字段显示顺序
3. 验证优先级字段在前
**预期结果:** 
- 字段按ExifProcessingTab._priority_list()顺序显示
- 高优先级字段（如色温、白平衡）在顶部
- 低优先级字段在底部
**验收标准:** 字段顺序与优先级列表完全一致

### TC002-02: 数据格式化验证
**前置条件:** 使用包含各种数据类型的测试图片
**测试步骤:**
1. 拖拽测试图片到主窗口
2. 检查浮点数、数组、字典类型数据显示
3. 验证格式化规则正确应用
**预期结果:** 
- 浮点数显示4位小数，去除尾随0
- 数组显示为逗号分隔
- 字典显示为JSON格式
- None值显示为"N/A"
**验收标准:** 所有数据类型格式化正确，无显示异常

### TC002-03: 文本选择复制功能
**前置条件:** EXIF对话框已打开
**测试步骤:**
1. 尝试选择字段名文本
2. 尝试选择字段值文本
3. 执行复制操作
**预期结果:** 
- 字段名和字段值都可以选择
- 复制功能正常工作
- 文本选择高亮显示正确
**验收标准:** 文本选择和复制功能完全正常

## TC003 - 应用生命周期测试

### TC003-01: 启动过程验证
**前置条件:** 应用未运行
**测试步骤:**
1. 启动应用程序
2. 监控启动日志
3. 等待主窗口完全显示
**预期结果:** 
- 启动过程无异常日志
- pywin32初始化成功
- 拖拽功能在showEvent后激活
- 启动签名日志正确输出
**验收标准:** 启动时间<3秒，无ERROR级别日志

### TC003-02: showEvent后拖拽激活
**前置条件:** 应用刚启动完成
**测试步骤:**
1. 确认主窗口已显示
2. 立即尝试拖拽操作
3. 验证拖拽功能可用
**预期结果:** 
- showEvent触发pywin注册流程
- 拖拽功能立即可用
- 注册成功日志输出
**验收标准:** showEvent后拖拽功能立即可用

### TC003-03: 关闭过程验证
**前置条件:** 应用正在运行
**测试步骤:**
1. 关闭应用程序
2. 监控关闭日志
3. 验证资源释放
**预期结果:** 
- pywin32资源正确释放
- 无内存泄漏
- 关闭过程无异常
**验收标准:** 关闭时间<2秒，资源完全释放

### TC003-04: 重复启动关闭测试
**前置条件:** 应用未运行
**测试步骤:**
1. 连续启动关闭应用10次
2. 监控内存使用变化
3. 检查系统资源占用
**预期结果:** 
- 每次启动关闭正常
- 内存使用无累积增长
- 系统资源无泄漏
**验收标准:** 10次循环后内存使用回到初始水平

## TC004 - 异常场景测试

### TC004-01: 损坏图片文件处理
**前置条件:** 准备损坏的图片文件
**测试步骤:**
1. 拖拽test_image_corrupted.jpg到主窗口
2. 观察应用响应
3. 检查错误处理
**预期结果:** 
- 显示错误对话框："解析图片失败"
- 应用不崩溃
- 错误信息准确
**验收标准:** 错误处理优雅，无应用崩溃

### TC004-02: 超大图片文件处理
**前置条件:** 准备>50MB的图片文件
**测试步骤:**
1. 拖拽超大图片文件到主窗口
2. 监控内存和CPU使用
3. 验证处理结果
**预期结果:** 
- 文件正常处理或优雅失败
- 内存使用在合理范围
- CPU使用不超过80%
**验收标准:** 处理时间<10秒，资源使用合理

### TC004-03: 网络路径文件处理
**前置条件:** 准备网络路径的图片文件
**测试步骤:**
1. 拖拽网络路径图片到主窗口
2. 验证处理结果
3. 检查网络访问处理
**预期结果:** 
- 网络文件正常处理或显示适当错误
- 无网络超时导致的应用挂起
- 错误信息清晰
**验收标准:** 网络文件处理正确，无应用阻塞

### TC004-04: 并发拖拽操作
**前置条件:** 准备多个图片文件
**测试步骤:**
1. 快速连续拖拽多个文件
2. 验证并发处理
3. 检查资源竞争
**预期结果:** 
- 每个拖拽操作独立处理
- 无资源竞争导致的异常
- 对话框正确显示和关闭
**验收标准:** 并发操作无异常，资源使用稳定

## TC005 - 性能基准测试

### TC005-01: 启动时间测量
**测试步骤:**
1. 记录应用启动开始时间
2. 记录主窗口显示完成时间
3. 计算启动耗时
4. 重复测试10次取平均值
**验收标准:** 平均启动时间<3秒

### TC005-02: 拖拽响应时间测量
**测试步骤:**
1. 记录拖拽开始时间
2. 记录EXIF对话框显示时间
3. 计算响应耗时
4. 重复测试20次取平均值
**验收标准:** 平均响应时间<500ms

### TC005-03: 内存使用监控
**测试步骤:**
1. 记录应用启动后内存使用
2. 执行10次拖拽操作
3. 记录操作后内存使用
4. 计算内存增长
**验收标准:** 内存增长<10%基线值

### TC005-04: CPU使用率监控
**测试步骤:**
1. 监控拖拽操作时CPU使用
2. 记录CPU峰值和平均值
3. 验证CPU使用合理性
**验收标准:** CPU峰值<30%，平均值<10%
